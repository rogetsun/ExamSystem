/*!
 * ExamSystem - compressed JS
 * @licence ExamSystem - v1.0.0 (2018-01-30)
  */
angular.module("exam",["exam.router","exam.controller","resource.question","resource.course","resource.paper","resource.faculty","resource.major","resource.exam","uv.fixed"]),angular.module("exam.router",[]).config(["$stateProvider",function(a){a.state("exam",{parent:"index",url:"/exam",template:"<ui-view></ui-view>",data:{left_states:[{title:"题库管理",state_name:"exam.question"},{title:"试卷管理",state_name:"exam.paper"},{title:"试卷编辑",state_name:"exam.paper-def",is_hide:1},{title:"发布考试",state_name:"exam.publish"},{title:"考试查询",state_name:"exam.query"}]}}).state("exam.question",{url:"/question",templateUrl:"app/teacher/exam/template/question-container.html",controller:"questionController",resolve:{courses:["courseService",function(a){return a.select().then(function(a){return a.data})}]}}).state("exam.question.list",{url:"/course/{course_id}/list",templateUrl:"app/teacher/exam/template/question.html",controller:"questionListController",resolve:{questions:["$stateParams","questionService",function(a,b){return b.select({cos_id:a.course_id}).then(function(a){return console.log(a.data),a.data})}]}}).state("exam.paper",{url:"/paper",templateUrl:"app/teacher/exam/template/paper-container.html",controller:"paperController",resolve:{courses:["courseService",function(a){return a.select().then(function(a){return a.data})}]}}).state("exam.paper.list",{url:"/course/{course_id}/list",templateUrl:"app/teacher/exam/template/paper.html",controller:"paperListController",resolve:{papers:["$stateParams","paperService",function(a,b){return b.select({cos_id:a.course_id}).then(function(a){return a.data})}]}}).state("exam.paper-def",{url:"/{course_id}/{paper_id}/def",templateUrl:"app/teacher/exam/template/paper-def.html",controller:"paperDefController",resolve:{paper:["$stateParams","paperService",function(a,b){if(a.paper_id)return b.select({paper_id:a.paper_id}).then(function(a){return a.data})}],course:["$stateParams","courseService",function(a,b){return b.select({cos_id:a.course_id}).then(function(a){return a.data})}],questions:["$stateParams","questionService",function(a,b){return b.select({cos_id:a.course_id}).then(function(a){return a.data})}]}}).state("exam.publish",{url:"/publish/{exam_id}",templateUrl:"app/teacher/exam/template/publish.html",controller:"publishController",resolve:{courses:["courseService",function(a){return a.select().then(function(a){return a.data})}],faculties:["facultyService",function(a){return a.select().then(function(a){return a.data})}],majors:["majorService",function(a){return a.select().then(function(a){return a.data})}],classes:["classService",function(a){return a.select().then(function(a){return a.data})}],exam:["$stateParams","examService",function(a,b){return a.exam_id?b.select({exam_id:a.exam_id}).then(function(a){return a.data}):{}}]}}).state("exam.query",{url:"/publish-query",templateUrl:"app/teacher/exam/template/publish-query.html",controller:"publishQueryController",resolve:{exam_info:["examService",function(a){return a.select().then(function(a){return a.data})}]}})}]),angular.module("exam.controller",["uv.service.tip","uv.service.dialog","ngDialog","pub","uv.directive.datetimepicker"]).controller("questionController",["$scope","$state","uvTip","uvDialog","ngDialog","questionService","courses",function(a,b,c,d,e,f,g){a.courses=g}]).controller("questionListController",["$scope","$state","$stateParams","$filter","uvTip","uvDialog","ngDialog","questionService","courses","questions",function(a,b,c,d,e,f,g,h,i,j){a.course=d("filter")(i,{cos_id:c.course_id})[0],a.questions=j,a.add=function(){a.def()},a.del=function(a){f.confirm("确定删除题目:<br>["+a.qt_content+"]么?").then(function(b){if(b)return h.del(a.qt_id)}).then(function(a){a&&0==a.ret_code?(e.showTip("删除成功",1500),b.reload()):e.showTip("删除失败,"+a.ret_msg)})},a.def=function(a){k(a).then(function(a){a&&b.reload()})},a.toggleShowDetail=function(a){a.show_detail=!a.show_detail,a.show_detail&&!a.options&&h.select_options(a.qt_id).then(function(b){b&&0==b.ret_code?a.options=b.data:e.showTip("查询题目选项失败,"+b.ret_msg)})};var k=function(b){return a._qt=b,g.open({scope:a,closeByDocument:!1,showClose:!1,overlay:!0,template:"question-input",controller:"questionDefController"}).closePromise.then(function(b){return delete a._qt,b.value})}}]).controller("questionDefController",["$scope","$filter","$stateParams","uvTip","uvDialog","questionService",function(a,b,c,d,e,f){a.opt_titles="ABCDEFGHIJKLMN".split(""),a._qt?a._qt.options||f.select_options(a._qt.qt_id).then(function(b){a._qt.options=b.data}):a._qt={is_multi:"0",cos_id:c.course_id,options:[{opt_title:"A"},{opt_title:"B"},{opt_title:"C"},{opt_title:"D"}]},a.addOption=function(){console.log(a._qt),a._qt.options.push({opt_title:a.opt_titles[a._qt.options.length]})},a.delOption=function(b){var c=a._qt.options;c.splice(b,1);for(var d=0;d<c.length;d++)c[d].opt_title=a.opt_titles[d]},a.setRight=function(b){"0"==a._qt.is_multi?(angular.forEach(a._qt.options,function(a){a.is_right="0"}),b.is_right="1"):b.is_right="1"==b.is_right?"0":"1"},a.changeMulti=function(c){if(a._qt.is_multi=c,console.log(c),0==c){var d=!1;angular.forEach(b("filter")(a._qt.options,{is_right:"1"}),function(a){console.log(a),d?a.is_right="0":d=!0})}},a.save=function(){if(0==b("filter")(a._qt.options,{is_right:"1"}).length)return void d.showTip("请设置正确答案",1500);f.save_or_update(a._qt).then(function(b){b&&0==b.ret_code?(d.showTip("保存成功",1500),a.closeThisDialog(1)):d.showTip("保存失败,"+b.ret_msg)})}}]).controller("paperController",["$scope","$state","uvTip","uvDialog","ngDialog","courses",function(a,b,c,d,e,f){a.courses=f}]).controller("paperListController",["$scope","$state","$stateParams","$filter","uvTip","uvDialog","ngDialog","paperService","courses","papers",function(a,b,c,d,e,f,g,h,i,j){a.course=d("filter")(i,{cos_id:c.course_id})[0],a.papers=j,a.add=function(){a.def()},a.def=function(c){var d={course_id:a.course.cos_id};c&&(d.paper_id=c.paper_id),b.go("exam.paper-def",d)},a.del=function(a){f.confirm("确定删除试卷["+a.paper_title+"]?").then(function(c){c&&h.del(a.paper_id).then(function(a){a&&0==a.ret_code?(e.showTip("删除成功",1500),b.reload()):e.showTip("删除失败,"+a.ret_msg)})})}}]).controller("paperDefController",["$rootScope","$scope","$filter","$state","uvLoading","uvTip","uvDialog","ngDialog","paperService","paper","course","questions",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(a){var c=b.sts=b.statistics={multi_count:0,multi_score:0,single_count:0,single_score:0};angular.forEach(b.paper.questions,function(a){1==a.is_multi?(a.score&&(c.multi_score+=parseInt(a.score)),c.multi_count++):(a.score&&(c.single_score+=parseInt(a.score)),c.single_count++)}),a||(b.paper.score=c.single_score+c.multi_score,b.paper.pass_score=parseInt(.6*b.paper.score))}b.questions=l,b.course=k,b.query={},a.content_title="["+k.cos_name+"]"+b.content_title,e.loading(),b.question_json={},angular.forEach(b.questions,function(a){b.question_json[a.qt_id]=a}),j&&angular.forEach(j.questions,function(a){b.question_json[a.qt_id].selected=!0,b.question_json[a.qt_id].score=a.score}),e.unloading(),b.paper=j||{cos_id:k.cos_id},b.configQuestion=function(){g.showTemplate("question-input",b).then(function(a){b.paper.questions=c("filter")(b.questions,{selected:!0}),b.paper.questions=c("orderBy")(b.paper.questions,"is_multi"),b.just_select=!1,b.random={},m()})};var n=!1;b.toggleSelect=function(){n=!n,angular.forEach(b.questions,function(a){a.selected=n})},b.delQuestion=function(a){var c=b.paper.questions.splice(a,1)[0];b.question_json[c.qt_id].selected=!1,m()},b.savePaper=function(){for(var a=!0,c=0;c<b.paper.questions.length;c++){var e=b.paper.questions[c];console.log(e.score),e.score||(f.showTip("请设置题目分数"),a=!1)}a&&i.save_or_update(b.paper).then(function(a){a&&0==a.ret_code?(b.paper.paper_id=a.data,f.showTip("保存成功",1500).then(function(){d.go("exam.paper.list",{course_id:k.cos_id})})):f.showTip("保存失败,"+a.ret_msg)})},b.changeScore=function(a){b.score=a,angular.forEach(b.paper.questions,function(b){b.score=a}),m()},b.just_select=!1,b.justSelect=function(){b.just_select=!b.just_select,b.just_select?b.query.selected=!0:delete b.query.selected},b.random={},b.createRandom=function(){if(b.random.single_select_count){var a=[],d=c("filter")(b.questions,{is_multi:"0"});if(b.random.single_select_count>d.length)return void f.showTip("题库中单选题只有["+d.length+"]道,不足["+b.random.single_select_count+"]道!",2e3);for(;a.length<b.random.single_select_count;){var e=parseInt(Math.random()*d.length);a.push(d.splice(e,1)[0])}for(var g=0;g<a.length;g++)b.question_json[a[g].qt_id].selected=!0,b.question_json[a[g].qt_id].score=b.random.single_select_score||2}if(b.random.multi_select_count){var h=[],i=c("filter")(b.questions,{is_multi:"1"});if(b.random.multi_select_count>i.length)return void f.showTip("题库中多选题只有["+i.length+"]道,不足["+b.random.multi_select_count+"]道!",2e3);for(;h.length<b.random.multi_select_count;){var e=parseInt(Math.random()*i.length);h.push(i.splice(e,1)[0])}for(var g=0;g<h.length;g++)b.question_json[h[g].qt_id].selected=!0,b.question_json[h[g].qt_id].score=b.random.multi_select_score||4}b.random={}},m(!0),b.stsQuestion=m}]).controller("publishController",["$scope","$state","uvTip","uvDialog","ngDialog","pubCourse","pubClass","courses","exam","faculties","majors","classes","paperService","examService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){a.courses=h,a.course_json={},angular.forEach(h,function(a){this[a.cos_id]=a},a.course_json),a.exam=i||{},a.faculties=j,a.majors=k,a.classes=l,a.papers=[],a.exam.cos_id&&m.select({cos_id:a.exam.cos_id}).then(function(b){a.papers=b.data}),a.selectCourse=function(){f.chooseCourse(a,a.courses).then(function(b){b&&(a.exam.cos_id=b.cos_id,m.select({cos_id:b.cos_id}).then(function(b){a.papers=b.data,a.paper_json={},angular.forEach(a.papers,function(b){a.paper_json[b.paper_id]=b})}))})},a.selectClass=function(){g.chooseClass(a,j,k,l,i.classes||[]).then(function(b){b&&(a.exam.classes=b)})},a.setExamPaper=function(){var b=a.paper_json[a.exam.paper_id];a.exam.pass_score=b.pass_score,a.exam.score=b.score},a.publishExam=function(){n.save_or_update(a.exam).then(function(a){a&&0==a.ret_code?c.showTip("发布成功").then(function(){b.reload()}):c.showTip("发布失败,"+a.ret_code)})}}]).controller("publishQueryController",["$rootScope","$scope","$filter","$state","uvLoading","uvTip","uvDialog","ngDialog","examService","exam_info",function(a,b,c,d,e,f,g,h,i,j){b.exams=j.exams,b.now=j.now,b.modifyExam=function(a){d.go("exam.publish",{exam_id:a.exam_id})},b.deleteExam=function(a){var c=b.exams[a];g.confirm("确定取消考试["+c.exam_title+"]?").then(function(a){a&&i.del(c.exam_id).then(function(a){a&&0==a.ret_code?f.showTip("取消考试成功",1500).then(function(){d.reload()}):f.showTip("取消考试失败,"+a.ret_msg)})})}}]),angular.module("fmc",["ngDialog","ngSanitize","ui.select","fmc.router","fmc.controller","resource.faculty","resource.major","resource.course"]),angular.module("fmc.router",[]).config(["$stateProvider",function(a){a.state("fmc",{parent:"index",url:"/fmc",template:"<ui-view></ui-view>",data:{left_states:[{title:"院系管理",state_name:"fmc.faculty"},{title:"专业管理",state_name:"fmc.major"},{title:"课程管理",state_name:"fmc.course"}]}}).state("fmc.faculty",{url:"/faculty",templateUrl:"app/teacher/faculty-major-course/template/faculty.html",controller:"facultyController",resolve:{facs:["facultyService",function(a){return a.select().then(function(a){return a.data})}]}}).state("fmc.major",{url:"/major",templateUrl:"app/teacher/faculty-major-course/template/major.html",controller:"majorController",resolve:{facs:["facultyService",function(a){return a.select().then(function(a){return a.data})}],majors:["majorService",function(a){return a.select().then(function(a){return a.data})}]}}).state("fmc.course",{url:"/course",templateUrl:"app/teacher/faculty-major-course/template/course.html",controller:"courseController",resolve:{courses:["courseService",function(a){return a.select().then(function(a){return a.data})}]}})}]),angular.module("fmc.controller",[]).controller("facultyController",["$scope","$state","ngDialog","uvTip","uvDialog","facs","facultyService",function(a,b,c,d,e,f,g){a.facs=f||[],a.modify=function(a){h(a.fac_name).then(function(c){c&&(a.fac_name=c.name,g.save_or_update(a).then(function(a){a&&0==a.ret_code?d.showTip("修改成功",1e3):e.show("修改失败,"+a.ret_msg).then(function(){b.reload()})},function(a){}))})},a.del=function(a){e.confirm("确定删除院系["+a.fac_name+"]以及院系下的专业?").then(function(c){c&&g.del(a.fac_id).then(function(a){a&&0==a.ret_code?d.showTip("删除成功",1e3).then(function(){b.reload()}):d.showTip("删除失败,"+a.ret_msg)})})},a.add=function(){h().then(function(a){if(a){var c={fac_name:a.name};g.save_or_update(c).then(function(a){a&&0==a.ret_code?d.showTip("添加成功",1e3).then(function(){b.reload()}):e.show("添加失败,"+a.ret_msg)})}})};var h=function(b){return a._name=b,c.open({scope:a,closeByDocument:!1,showClose:!1,template:"data-input",overlay:!0}).closePromise.then(function(b){return delete a._name,b.value})}}]).controller("majorController",["$scope","$timeout","$state","uvTip","uvDialog","ngDialog","majorService","facs","majors",function(a,b,c,d,e,f,g,h,i){a.facs=h,a.facs_json={},a.courses=[],angular.forEach(a.facs,function(b){a.facs_json[b.fac_id]=b.fac_name}),a.majors=i,a.query={},a.is_filter=!1,a.add=function(){j().then(function(a){a&&g.save_or_update(a).then(function(a){a&&0==a.ret_code?d.showTip("新增专业成功",1500).then(function(){c.reload()}):d.showTip("新增专业失败,"+a.ret_msg)})})},a.modify=function(a){j(a).then(function(a){a&&g.save_or_update(a).then(function(a){a&&0==a.ret_code?d.showTip("修改专业成功",1500).then(function(){c.reload()}):d.showTip("修改专业失败,"+a.ret_msg)})})},a.del=function(a){e.confirm("确定删除["+a.major_name+"]专业?").then(function(b){b&&g.del(a.major_id).then(function(a){a&&0==a.ret_code?d.showTip("删除成功",1500).then(function(a){c.reload()}):d.showTip("删除失败,"+a.ret_msg)})})},a.getMajorCourse=function(a){a.show_course=!a.show_course,a.show_course&&g.selectCourse(a.major_id).then(function(b){a.courses=b.data})},a.addMajorCourse=function(b){g.selectCanChooseCourses(b.major_id).then(function(b){return a.courses=b.data,k()}).then(function(a){a&&g.addMajorCourse(b.major_id,a.course.cos_id).then(function(c){c&&0==c.ret_code?(d.showTip("为专业添加课程成功",1500),b.courses.push(a.course)):d.showTip("添加失败,"+c.ret_msg)})})},a.delMajorCourse=function(a,b){e.confirm("确定删除["+a.courses[b].cos_name+"]课程?").then(function(c){c&&g.delMajorCourse(a.major_id,a.courses[b].cos_id).then(function(c){c&&0==c.ret_code?(d.showTip("删除成功",1500),a.courses.splice(b,1)):d.showTip("删除失败,"+c.ret_msg)})})},a.$watch("query",function(){a.filter={},a.query.fac_id&&(a.filter.fac_id=a.query.fac_id),a.query.major_name&&(a.filter.major_name=a.query.major_name)},!0);var j=function(b){return a._major=b||{},f.open({scope:a,closeByDocument:!1,showClose:!1,template:"data-input",overlay:!0}).closePromise.then(function(b){return delete a._major,b.value})},k=function(){return a._course={},f.open({scope:a,closeByDocument:!1,showClose:!1,template:"data-input2",overlay:!0}).closePromise.then(function(b){return delete a._course,b.value})}}]).controller("courseController",["$scope","$timeout","$state","uvTip","uvDialog","ngDialog","courseService","courses",function(a,b,c,d,e,f,g,h){a.query={},a.courses=h,a.add=function(){i().then(function(a){if(a){var b={cos_name:a.cos_name,cos_credit:a.cos_credit};g.save_or_update(b).then(function(a){a&&0==a.ret_code?d.showTip("新增课程成功",1500).then(function(){c.reload()}):d.showTip("新增课程失败,"+a.ret_msg)})}})},a.modify=function(a){i(a.cos_name,a.cos_credit).then(function(b){b&&(a.cos_name=b.cos_name,a.cos_credit=b.cos_credit,g.save_or_update(a).then(function(a){a&&0==a.ret_code?d.showTip("修改课程成功",1500).then(function(){c.reload()}):d.showTip("修改课程失败,"+a.ret_msg)}))})},a.del=function(a){e.confirm("确定删除["+a.cos_name+"]课程?").then(function(b){b&&g.del(a.cos_id).then(function(a){a&&0==a.ret_code?d.showTip("删除成功",1500).then(function(a){c.reload()}):d.showTip("删除失败,"+a.ret_msg)})})};var i=function(b,c){return a._cos_name=b,a._cos_credit=c,f.open({scope:a,closeByDocument:!1,showClose:!1,template:"data-input",overlay:!0}).closePromise.then(function(b){return delete a._cos_name,delete a._cos_credit,b.value&&b.value.cos_credit&&(b.value.cos_credit=b.value.cos_credit.replaceAll("。",".").replaceAll(",",".").replaceAll("，",".")),b.value})}}]),angular.module("teacher-app",["ui.router","ngDialog","util.httpInterceptor","uv.service.loading","uv.service.dialog","uv.service.tip","fmc","tsc","exam"]).config(["$urlRouterProvider","$stateProvider","uvLoadingProvider","$locationProvider",function(a,b,c,d){console.log("teacher config begin;"),c.setLoadingGif("assets/diy/uv-loading/loading.gif"),a.otherwise("/index"),d.html5Mode(!0),b.state("index",{url:"/index",data:{nav_funcs:[{title:"考试管理",state_name:"exam"},{title:"教师班级学生管理",state_name:"tsc"},{title:"院系专业课程管理",state_name:"fmc"}]},views:{"navbar@":{templateUrl:"app/teacher/index/template/navbar.html",controller:["$rootScope","$scope","$state","ngDialog","uvDialog","teacherService",function(a,b,c,d,e,f){b.funcs=c.current.data.nav_funcs,b.logout=function(){window.location="logout"},b.modify_self=function(){c.go("user.update",{login_id:b.login_user_id,next_state:"index"})},b.modify_password=function(){return b.user=b.login_user,d.open({scope:b,closeByDocument:!1,showClose:!1,template:"change_password_dialog",overlay:!0,controller:["$scope","$q",function(a,b){a.valid={},a.change_password=function(){var b={tch_id:a.user.tch_id};a.valid_old().then(function(b){return!!b&&(a.valid={},a.new_password?a.new_password==a.new_password_repeat||(a.valid.new_password_repeat="两次输入的新密码不一致",!1):(a.valid.new_password="请输入新密码",!1))}).then(function(c){c&&(b.tch_passwd=md5(a.new_password),b.old_password=md5(a.old_password),f.changePassword(b).then(function(a){a&&"0"==a.ret_code?e.show("修改成功,请重新登录").then(function(){window.location="logout"}):e.show("修改失败["+a.ret_code+"],"+a.ret_msg)}))})},a.valid_old=function(){var c=b.defer();if(delete a.valid.old_password,a.old_password){md5(md5(a.old_password))!=a.user.tch_passwd?(c.resolve(!1),a.valid.old_password="当前密码错误"):c.resolve(!0)}else a.valid.old_password="请输入当前密码",c.resolve(!1);return c.promise}}]}).closePromise.then(function(a){})},b.changeState=function(a){c.go(a)}}]},"left@":{templateUrl:"app/teacher/index/template/left.html",controller:["$scope","$rootScope",function(a,b){}]},"content@":{templateUrl:"app/teacher/index/template/content.html"}}}),console.log("teacher config over;")}]).run(["$state","$rootScope","uvLoading","teacherService",function(a,b,c,d){d.select_login_teacher().then(function(a){console.log(a),b.login_user=a.data,b.login_user_id=a.data.tch_id}),b.$on("$stateChangeStart",function(a,b,d,e,f){console.log("$stateChangeStart:"+e+"->"+b),c.loading()}),b.$on("$stateChangeSuccess",function(d,e,f,g,h){console.log("$stateChangeStart:"+g+"->"+e),c.unloading(),b.current_state_name=e.name;var i=e.name.split(".");if(console.log("fromState:"+g.name+",toState:"+e.name+",toStateArr:"+i),g.name.split(".")[0]!=i[0]&&(b.left_states=a.get(e.name.split(".")[0]).data.left_states,1==i.length))return console.log("auto transitionTo level2 state:"+b.left_states[0].state_name),a.transitionTo(b.left_states[0].state_name),!0;if(i.length>=2){var j=i[0]+"."+i[1];angular.forEach(b.left_states,function(a){a.state_name==j&&(b.content_title=a.title)})}})}]),angular.module("pub.class",["uv.service.dialog","uv.directive.tree"]).config(["uvTreeConfigProvider",function(a){a.setImgFolder("assets/diy/uv-tree/img")}]).service("pubClass",["uvDialog","$filter",function(a,b){this.chooseClass=function(a,b,d,e,f,g){return c(a,b,d,e,f,g)};var c=function(b,c,d,e,f,g){function h(a){for(var b=i["c"+a.cls_id];b&&!b.selected;)console.log(b),b.selected=!0,b=i[b.pid]}var i={},j=[],k={id:0,name:"学校",pid:-1};return j.push(k),i[k.id]=k,angular.forEach(c,function(a){var b={id:"f"+a.fac_id,name:a.fac_name,pid:0,data:a};i[b.id]=b,j.push(b)}),angular.forEach(d,function(a){var b={id:"m"+a.major_id,name:a.major_name,pid:"f"+a.fac_id,data:a};i[b.id]=b,j.push(b)}),angular.forEach(e,function(a){var b={id:"c"+a.cls_id,name:a.cls_no,pid:"m"+a.major_id,data:a};j.push(b),i[b.id]=b}),angular.forEach(f,function(a){h(a)}),a.showTemplate("app/teacher/public/template/class-select.html",b,{_toSelectTree:j},"classSelectController")}}]).controller("classSelectController",["$scope",function(a){a.class_tree_name="class_tree",a.tree_data=a._toSelectTree,a.ok=function(){var b=[];angular.forEach(a.class_tree.getSelected(),function(a){"string"==typeof a.id&&"c"==a.id.charAt(0)&&b.push(a.data)}),console.log(b),a.closeThisDialog(b)}}]),angular.module("pub.course",["uv.service.dialog"]).service("pubCourse",["uvDialog",function(a){this.chooseCourse=function(a,c){return b(a,c)};var b=function(b,c){return a.showTemplate("app/teacher/public/template/course-select.html",b,{toSelectCourses:c},["$scope","$location","$anchorScroll",function(a,b,c){a.selected_course=null,a.cs={},angular.forEach(a.toSelectCourses,function(a){var b=$.toJianpin(a.cos_name)[0],c=b.charAt(0).toUpperCase();this[c]||(this[c]=[]),this[c].push(a)},a.cs),a.titles=[],angular.forEach(a.cs,function(a,b){this.push(b)},a.titles),a.goto=function(a){b.hash(a),c()}}])}}]),angular.module("pub",["pub.course","pub.class"]),angular.module("class",["ui.router","resource.class","resource.major","class.router","class.controller"]),angular.module("class.router",[]).config(["$stateProvider",function(a){a.state("tsc.class",{url:"/class",templateUrl:"app/teacher/teacher-student-class/template/class.html",controller:"classController",resolve:{majors:["majorService",function(a){return a.select().then(function(a){return a.data})}],classes:["classService",function(a){return a.select().then(function(a){return a.data})}]}})}]),angular.module("class.controller",[]).controller("classController",["$scope","$state","uvTip","uvDialog","ngDialog","classService","classes","majors",function(a,b,c,d,e,f,g,h){a.classes=g,a.majors=h,a.major_json={},angular.forEach(h,function(a){this[a.major_id]=a},a.major_json),a.del=function(a){d.confirm("确定删除班级["+a.cls_no+"](不会删除班级下的学生)?").then(function(d){d&&f.del(a.cls_id).then(function(a){a&&0==a.ret_code?(c.showTip("删除成功",1500),b.reload()):c.showTip("删除失败,"+a.ret_msg)})})},a.add=function(){i().then(function(a){a&&f.save_or_update(a).then(function(a){a&&0==a.ret_code?(c.showTip("新增成功",1500),b.reload()):c.showTip("新增班级失败,"+a.ret_code)})})},a.modify=function(a){i(a).then(function(a){a&&f.save_or_update(a).then(function(a){a&&0==a.ret_code?(c.showTip("修改成功",1500),b.reload()):c.showTip("修改班级失败,"+a.ret_code)})})};var i=function(b){return b?(b.major=a.major_json[b.major_id],a._class=angular.copy(b)):a._class={},e.open({scope:a,closeByDocument:!1,showClose:!1,template:"data-input",overlay:!0}).closePromise.then(function(b){return delete a._class,b.value.major_id=b.value.major.major_id,b.value})}}]),angular.module("student",["student.router","student.controller","resource.student","resource.major","resource.class"]),angular.module("student.router",["ui.router"]).config(["$stateProvider",function(a){a.state("tsc.student",{url:"/student",templateUrl:"app/teacher/teacher-student-class/template/student.html",resolve:{students:["studentService",function(a){return a.select().then(function(a){return a.data})}]},controller:"studentController"})}]),angular.module("student.controller",[]).controller("studentController",["$scope","$state","uvTip","ngDialog","uvDialog","studentService","students",function(a,b,c,d,e,f,g){a.students=g,a.add=function(){h().then(function(a){a&&b.reload()})},a.del=function(a){e.confirm("确定删除["+a.std_login+"-"+a.std_name+"]学生?").then(function(d){d&&f.del(a.std_id).then(function(a){a&&0==a.ret_code?(c.showTip("删除成功"),b.reload()):c.showTip("删除失败,"+a.ret_msg)})})},a.modify=function(a){h(a).then(function(a){a&&b.reload()})};var h=function(b){var c={};return b&&(c=angular.copy(b)),a._std=c,d.open({scope:a,closeByDocument:!1,showClose:!1,template:"data-input",overlay:!0,controller:"studentDefController"}).closePromise.then(function(b){return delete a._std,b.value})}}]).controller("studentDefController",["$scope","$filter","studentService","uvTip",function(a,b,c,d){a.$watch("_std.in_time",function(c){var d=b("date")(c,"yyyy-MM-dd");a._std.in_time=d}),a.save_or_update=function(b){b&&b.std_login&&c.save_or_update(b).then(function(b){b&&0==b.ret_code?(d.showTip("保存成功",1500),a.closeThisDialog(!0)):d.showTip("保存失败,"+b.ret_msg)})}}]),angular.module("teacher",["teacher.router","teacher.controller","resource.teacher"]),angular.module("teacher.router",["ui.router"]).config(["$stateProvider",function(a){a.state("tsc.teacher",{url:"/teacher",templateUrl:"app/teacher/teacher-student-class/template/teacher.html",resolve:{teachers:["teacherService",function(a){return a.select().then(function(a){return a.data})}]},controller:"teacherController"})}]),angular.module("teacher.controller",[]).controller("teacherController",["$scope","$state","uvTip","ngDialog","uvDialog","teacherService","teachers",function(a,b,c,d,e,f,g){a.teachers=g,a.add=function(){h().then(function(a){a&&b.reload()})},a.del=function(a){e.confirm("确定删除["+a.tch_login+"-"+a.tch_name+"]教师?").then(function(d){d&&f.del(a.tch_id).then(function(a){a&&0==a.ret_code?(c.showTip("删除成功"),b.reload()):c.showTip("删除失败,"+a.ret_msg)})})},a.modify=function(a){h(a).then(function(a){a&&b.reload()})};var h=function(b){return b&&angular.copy(b),a._tch=b||{},d.open({scope:a,closeByDocument:!1,showClose:!1,template:"data-input",overlay:!0,controller:"teacherDefController"}).closePromise.then(function(b){return delete a._tch,b.value})}}]).controller("teacherDefController",["$scope","$filter","teacherService","uvTip",function(a,b,c,d){a.$watch("_tch.in_time",function(c){var d=b("date")(c,"yyyy-MM-dd");console.log(d),a._tch.in_time=d}),a.save_or_update=function(b){b&&b.tch_login&&c.save_or_update(b).then(function(b){b&&0==b.ret_code?(d.showTip("保存成功",1500),a.closeThisDialog(!0)):d.showTip("保存失败,"+b.ret_msg)})}}]),angular.module("tsc",["teacher","class","student"]).config(["$stateProvider",function(a){a.state("tsc",{parent:"index",url:"/tsc",template:"<ui-view></ui-view>",data:{left_states:[{title:"教师管理",state_name:"tsc.teacher"},{title:"班级管理",state_name:"tsc.class"},{title:"学生管理",state_name:"tsc.student"}]}})}]);